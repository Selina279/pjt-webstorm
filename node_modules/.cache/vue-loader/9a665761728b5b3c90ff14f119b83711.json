{"remainingRequest":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/src/components/sys/basic/PermissMana.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/src/components/sys/basic/PermissMana.vue","mtime":1588037655548},{"path":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/selina/Documents/Vueworkspace/vuewebstrom/yourparttime/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoucGVybWlzc01hbmFUb29sMXsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7Cn0KLnBlcm1pc3NNYW5hVG9vbDEgLmVsLWlucHV0ewogICAgd2lkdGg6IDMwMHB4OwogICAgbWFyZ2luLXJpZ2h0OiAxMHB4Owp9Ci5wZXJtaXNzTWFuYU1haW57CiAgICAgbWFyZ2luLXRvcDogMTVweDsKICAgICB3aWR0aDogNzAlOwp9Cg=="},{"version":3,"sources":["PermissMana.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PermissMana.vue","sourceRoot":"src/components/sys/basic","sourcesContent":["<template>\n    <div>\n        <div class=\"permissManaTool1\">\n            <el-input size=\"small\" placeholder=\"请输入角色英文名\" v-model=\"role.name\">\n                <tempate slot=\"prepend\">ROLE_</tempate>\n            </el-input>\n            <el-input size=\"small\" placeholder=\"请输入角色中文名\" v-model=\"role.nameZh\" @keydown.enter.native=\"doAddRole\"></el-input>\n             <el-button  type=\"primary\" size=\"small\" icon=\"el-icon-plus\" @click=\"doAddRole\">添加角色</el-button>\n        </div>\n        <div class=\"permissManaMain\">\n            <el-collapse v-model=\"activeName\" accordion @change=\"change\">\n              <el-collapse-item :title=\"r.nameZh\" :name=\"r.id\" v-for=\"(r,index) in roles\" :key=\"index\">\n                  <el-card class=\"box-card\">\n                      <div slot=\"header\" class=\"clearfix\">\n                          <span>可访问的资源</span>\n                          <el-button style=\"float: right; padding: 3px 0;color: #ff0000\" icon=\"el-icon-delete\" type=\"text\" @click=\"deleteRole(r)\"></el-button>\n                      </div>\n                      <div>\n                          <el-tree\n                                  show-checkbox\n                                  node-key=\"id\"\n                                  ref=\"tree\"\n                                  :default-checked-keys=\"selectedMenus\"\n                                  :data=\"allmenus\"\n                                  :props=\"defaultProps\">\n                          </el-tree>\n                          <div style=\"display: flex;justify-content: flex-end\">\n                              <el-button size=\"small\" @click=\"cancelUpdate\">取消修改</el-button>\n                              <el-button size=\"small\" type=\"primary\" @click=\"doUpdate(r.id,index)\">确认修改</el-button>\n                          </div>\n                      </div>\n                  </el-card>\n              </el-collapse-item>\n            </el-collapse>\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n        name: \"PermissMana\",\n        data(){\n            return{\n                activeName: -1,\n                role:{\n                    name:'',\n                    nameZh:''\n                },\n                roles:[],\n                allmenus:[],\n                selectedMenus:[],\n                defaultProps: {\n                    children: 'children',\n                    label: 'name'\n                }\n            }\n        },\n        mounted() {\n            this.initRoles();\n        },\n        methods:{\n            deleteRole(role){\n                this.$confirm('此操作将永久删除【'+role.nameZh+'】角色, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    this.deleteRequest(\"/system/basic/permiss/role/\"+role.id).then(resp=>{\n                        if(resp){\n                            this.initRoles();\n                        }\n                    })\n                }).catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消删除'\n                    });\n                });\n            },\n            doAddRole(){\n                if(this.role.name && this.role.nameZh){\n                    this.postRequest(\"/system/basic/permiss/role\",this.role).then(resp=>{\n                        if(resp){\n                            this.role.name='';\n                            this.role.nameZh='';\n                            this.initRoles();\n                        }\n                    })\n                }else{\n                    this.$message.error('数据不能为空');\n                }\n            },\n            cancelUpdate(){\n                this.activeName=-1;\n            },\n            doUpdate(uid,index){\n                // console.log(uid);\n                let tree = this.$refs.tree[index];\n                let selectedKeys=tree.getCheckedKeys(true);\n                let url='/system/basic/permiss/?uid='+uid;\n                selectedKeys.forEach(key=>{\n                    url+='&mids='+key;\n                })\n                this.putRequest(url).then(resp=>{\n                    if(resp){\n                        this.activeName=-1;\n                    }\n                })\n                // console.log(selectedKeys);\n            },\n            change(uid){\n                if(uid){\n                    this.initAllMenus();\n                    this.initSelectedMenus(uid);\n                }\n            },\n            initSelectedMenus(uid){\n              this.getRequest(\"/system/basic/permiss/mids/\"+uid).then(resp=>{\n                  console.log('!!!'+resp);\n                  if(resp){\n                      this.selectedMenus=resp;\n                  }\n              })\n            },\n            initAllMenus(){\n              this.getRequest(\"/system/basic/permiss/menus\").then(resp=>{\n                  if(resp){\n                      this.allmenus=resp;\n                  }\n              })\n            },\n            initRoles(){\n                this.getRequest(\"/system/basic/permiss/\").then(resp=>{\n                    if(resp){\n                        this.roles=resp;\n                    }\n                })\n            }\n        }\n    }\n</script>\n\n<style>\n    .permissManaTool1{\n        display: flex;\n        justify-content: flex-start;\n    }\n    .permissManaTool1 .el-input{\n        width: 300px;\n        margin-right: 10px;\n    }\n    .permissManaMain{\n         margin-top: 15px;\n         width: 70%;\n    }\n</style>"]}]}